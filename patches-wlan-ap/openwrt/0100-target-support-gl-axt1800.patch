From 0e7161196e7988e35d634a23340980e33ae4e748 Mon Sep 17 00:00:00 2001
From: Jianhui Zhao <jianhui.zhao@gl-inet.com>
Date: Thu, 20 Jan 2022 17:53:37 +0800
Subject: [PATCH] target: support gl-axt1800

Signed-off-by: Jianhui Zhao <jianhui.zhao@gl-inet.com>
---
 target/linux/ipq807x/base-files/etc/board.d/02_network |  3 ++-
 .../etc/hotplug.d/firmware/10-ath11k-caldata           |  3 ++-
 .../linux/ipq807x/base-files/lib/upgrade/platform.sh   |  2 ++
 target/linux/ipq807x/image/ipq60xx.mk                  | 10 ++++++++++
 4 files changed, 16 insertions(+), 2 deletions(-)

diff --git a/target/linux/ipq807x/base-files/etc/board.d/02_network b/target/linux/ipq807x/base-files/etc/board.d/02_network
index e9d5ca941f..f23392f0ab 100755
--- a/target/linux/ipq807x/base-files/etc/board.d/02_network
+++ b/target/linux/ipq807x/base-files/etc/board.d/02_network
@@ -36,7 +36,8 @@ qcom_setup_interfaces()
 		ucidef_set_interface_lan "eth0"
 		ucidef_set_interface_wan "eth1"
 		;;
-	edgecore,eap101)
+	edgecore,eap101|\
+	glinet,axt1800)
 		ucidef_set_interface_lan "eth1 eth2"
 		ucidef_set_interface_wan "eth0"
 		;;
diff --git a/target/linux/ipq807x/base-files/etc/hotplug.d/firmware/10-ath11k-caldata b/target/linux/ipq807x/base-files/etc/hotplug.d/firmware/10-ath11k-caldata
index c8b4341aa1..1fef353f2b 100755
--- a/target/linux/ipq807x/base-files/etc/hotplug.d/firmware/10-ath11k-caldata
+++ b/target/linux/ipq807x/base-files/etc/hotplug.d/firmware/10-ath11k-caldata
@@ -74,7 +74,8 @@ case "$FIRMWARE" in
 	wallys,dr6018|\
 	wallys,dr6018-v4|\
 	qcom,ipq6018-cp01|\
-	xiaomi,ax1800)
+	xiaomi,ax1800|\
+	glinet,axt1800)
                 caldata_extract "0:ART" 0x1000 0x20000  
 		;;
 	esac
diff --git a/target/linux/ipq807x/base-files/lib/upgrade/platform.sh b/target/linux/ipq807x/base-files/lib/upgrade/platform.sh
index 1cd40b29f5..b0191a6bfe 100755
--- a/target/linux/ipq807x/base-files/lib/upgrade/platform.sh
+++ b/target/linux/ipq807x/base-files/lib/upgrade/platform.sh
@@ -24,6 +24,7 @@ platform_check_image() {
 	cig,wf188n|\
 	cig,wf194c|\
 	cig,wf194c4|\
+	glinet,axt1800|\
 	wallys,dr6018|\
 	wallys,dr6018-v4|\
 	edgecore,eap101|\
@@ -56,6 +57,7 @@ platform_do_upgrade() {
 	cig,wf188n|\
 	cig,wf194c|\
 	cig,wf194c4|\
+	glinet,axt1800|\
 	hfcl,ion4xi|\
 	hfcl,ion4xe|\
 	qcom,ipq6018-cp01|\
diff --git a/target/linux/ipq807x/image/ipq60xx.mk b/target/linux/ipq807x/image/ipq60xx.mk
index 4c779435f5..69a8e4a6e8 100644
--- a/target/linux/ipq807x/image/ipq60xx.mk
+++ b/target/linux/ipq807x/image/ipq60xx.mk
@@ -81,3 +81,13 @@ define Device/xiaomi_ax1800
   DEVICE_PACKAGES := ath11k-wifi-xiaomi-ax1800
 endef
 TARGET_DEVICES += xiaomi_ax1800
+
+define Device/glinet_axt1800
+  DEVICE_TITLE := GL-iNet AXT1800
+  DEVICE_DTS := qcom-ipq6018-gl-axt1800
+  SUPPORTED_DEVICES := glinet,axt1800
+  DEVICE_DTS_CONFIG := config@cp03-c1
+  DEVICE_PACKAGES := ath11k-wifi-gl-axt1800 -kmod-usb-dwc3-of-simple kmod-usb-dwc3-qcom
+endef
+TARGET_DEVICES += glinet_axt1800
+
-- 
2.25.1

