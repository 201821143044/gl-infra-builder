From 6796b58597e2974ff218db5f84ef61496c68b784 Mon Sep 17 00:00:00 2001
From: "GL.iNet-Xinfa.Deng" <xinfa.deng@gl-inet.com>
Date: Fri, 28 May 2021 12:06:11 +0800
Subject: [PATCH] update: bridge-utils package

Signed-off-by: GL.iNet-Xinfa.Deng <xinfa.deng@gl-inet.com>
---
 openwrt-18.06/package/utils/bridge-utils/Makefile  | 49 ++++++++++++++++++++++
 .../patches/001-libbridge_cflags.patch             | 11 +++++
 2 files changed, 60 insertions(+)
 create mode 100644 openwrt-18.06/package/utils/bridge-utils/Makefile
 create mode 100644 openwrt-18.06/package/utils/bridge-utils/patches/001-libbridge_cflags.patch

diff --git a/openwrt-18.06/package/utils/bridge-utils/Makefile b/openwrt-18.06/package/utils/bridge-utils/Makefile
new file mode 100644
index 0000000..e9e3472
--- /dev/null
+++ b/openwrt-18.06/package/utils/bridge-utils/Makefile
@@ -0,0 +1,49 @@
+#
+# Copyright (C) 2006-2015 OpenWrt.org
+#
+# This is free software, licensed under the GNU General Public License v2.
+# See /LICENSE for more information.
+#
+
+include $(TOPDIR)/rules.mk
+include $(INCLUDE_DIR)/kernel.mk
+
+PKG_NAME:=bridge-utils
+PKG_VERSION:=1.6
+PKG_RELEASE:=3
+
+PKG_SOURCE:=$(PKG_NAME)-$(PKG_VERSION).tar.xz
+PKG_SOURCE_URL:=@KERNEL/linux/utils/net/$(PKG_NAME)
+PKG_HASH:=cc67efb5d5fb8928a6569b3fade2b4042ec17da04678dab127d96b46489e26c8
+PKG_MAINTAINER:=Nikolay Martynov <mar.kolya@gmail.com>
+
+PKG_LICENSE:=GPL-2.0-or-later
+PKG_LICENSE_FILES:=COPYING
+PKG_FIXUP:=autoreconf
+
+include $(INCLUDE_DIR)/package.mk
+
+define Package/bridge
+  SECTION:=net
+  CATEGORY:=Base system
+  TITLE:=Ethernet bridging configuration utility
+  URL:=http://www.linuxfromscratch.org/blfs/view/svn/basicnet/bridge-utils.html
+  ALTERNATIVES:=300:/usr/sbin/brctl:/usr/libexec/bridge-utils-brctl
+endef
+
+define Package/bridge/description
+ Manage ethernet bridging: a way to connect networks together to
+ form a larger network.
+endef
+
+TARGET_CFLAGS += -D_LARGEFILE64_SOURCE -D_FILE_OFFSET_BITS=64 -D_GNU_SOURCE
+
+CONFIGURE_ARGS += \
+	--with-linux-headers="$(LINUX_DIR)" \
+
+define Package/bridge/install
+	$(INSTALL_DIR) $(1)/usr/libexec
+	$(INSTALL_BIN) $(PKG_BUILD_DIR)/brctl/brctl $(1)/usr/libexec/bridge-utils-brctl
+endef
+
+$(eval $(call BuildPackage,bridge))
diff --git a/openwrt-18.06/package/utils/bridge-utils/patches/001-libbridge_cflags.patch b/openwrt-18.06/package/utils/bridge-utils/patches/001-libbridge_cflags.patch
new file mode 100644
index 0000000..e35a649
--- /dev/null
+++ b/openwrt-18.06/package/utils/bridge-utils/patches/001-libbridge_cflags.patch
@@ -0,0 +1,11 @@
+--- a/libbridge/Makefile.in
++++ b/libbridge/Makefile.in
+@@ -5,7 +5,7 @@ AR=ar
+ RANLIB=@RANLIB@
+ 
+ CC=@CC@
+-CFLAGS = -Wall -g $(KERNEL_HEADERS)
++CFLAGS = -Wall -g @CFLAGS@ $(KERNEL_HEADERS)
+ 
+ prefix=@prefix@
+ exec_prefix=@exec_prefix@
-- 
2.7.4

