From 9593f4b59592c41f5bed35ca1a1abd828d1b69ef Mon Sep 17 00:00:00 2001
From: "GL.iNet-Xinfa.Deng" <xinfa.deng@gl-inet.com>
Date: Thu, 14 Oct 2021 14:57:57 +0800
Subject: [PATCH] fix: modified the min_free_kbytes from 16384 to 4096

---
 .../package/base-files/files/etc/init.d/sysctl       | 20 +++++++++++---------
 1 file changed, 11 insertions(+), 9 deletions(-)

diff --git a/openwrt-18.06/package/base-files/files/etc/init.d/sysctl b/openwrt-18.06/package/base-files/files/etc/init.d/sysctl
index 4db5644..9295f30 100755
--- a/openwrt-18.06/package/base-files/files/etc/init.d/sysctl
+++ b/openwrt-18.06/package/base-files/files/etc/init.d/sysctl
@@ -7,15 +7,17 @@ apply_defaults() {
 	local mem="$(awk '/^MemTotal:/ {print $2}' /proc/meminfo)"
 	local min_free frag_low_thresh frag_high_thresh
 
-	if [ "$mem" -gt 65536 ]; then # 128M
-		min_free=16384
-	elif [ "$mem" -gt 32768 ]; then # 64M
-		min_free=8192
-	else
-		min_free=1024
-		frag_low_thresh=393216
-		frag_high_thresh=524288
-	fi
+	#Fixed SF oom bug
+	min_free=4096
+	#if [ "$mem" -gt 65536 ]; then # 128M
+	#	min_free=16384
+	#elif [ "$mem" -gt 32768 ]; then # 64M
+	#	min_free=8192
+	#else
+	#	min_free=1024
+	#	frag_low_thresh=393216
+	#	frag_high_thresh=524288
+	#fi
 
 	sysctl -qw vm.min_free_kbytes="$min_free"
 
-- 
2.7.4

